// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions", "views"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [timescaledb, vector]
}

model query {
  id                    String?   @default(uuid()) @db.Uuid
  createdAt             DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt             DateTime  @updatedAt
  responseTime          Int
  query                 String
  response              String
  queryInEnglish        String
  responseInEnglish     String
  userId                String    @db.Uuid
  reaction              Int       @default(0) @db.SmallInt
  workflowId            Int?      @unique
  workflow              workflow? @relation(fields: [workflowId], references: [id])
  conversationId        String    @db.Uuid
  conversation          conversation @relation(fields: [conversationId], references: [id])
  isConversationDeleted Boolean @default(false)

  @@unique([userId, createdAt])
}

model conversation {
  id                    String    @default(uuid()) @db.Uuid
  createdAt             DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt             DateTime  @updatedAt
  userId                String    @db.Uuid
  query                 query[]
  workflowId            Int?      @unique
  workflow              workflow? @relation(fields: [workflowId], references: [id])
  context               Json    
  @@unique([id])
}

model workflow {
  createdAt      DateTime @default(now()) @db.Timestamptz(3)
  updatedAt      DateTime @updatedAt
  id             Int      @id @default(autoincrement())
  userId         String   @db.Uuid
  content        Json
  queryId        String?
  query          query?
  conversationId String?
  conversation   conversation?
}

model config {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt
  version   Int
  data      Json
  question  String
  answer    String
}